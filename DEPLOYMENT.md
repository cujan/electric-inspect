# Production Deployment Instructions

## HTTPS Configuration

To fix the "This request has been blocked; the content must be served over HTTPS" error, follow these steps:

### 1. Update .env file on your production server

Change the following variables in your `.env` file:

```env
APP_ENV=production
APP_DEBUG=false
APP_URL=https://yourdomain.com

# Session and Cookie Security
SESSION_SECURE_COOKIE=true
SESSION_DRIVER=database
```

**Important:** Replace `https://yourdomain.com` with your actual domain name.

### 2. Clear Laravel cache

After updating the `.env` file, run these commands on your server:

```bash
php artisan config:clear
php artisan cache:clear
php artisan route:clear
php artisan view:clear
```

### 3. Configure your web server

#### For Nginx:

Add this to your server block:

```nginx
server {
    listen 443 ssl http2;
    server_name yourdomain.com;

    # SSL Configuration
    ssl_certificate /path/to/ssl/certificate.crt;
    ssl_certificate_key /path/to/ssl/private.key;

    # Redirect HTTP to HTTPS
    if ($scheme != "https") {
        return 301 https://$server_name$request_uri;
    }

    # Add headers for security
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # Laravel configuration
    root /path/to/your/project/public;
    index index.php;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;

        # Important: Tell Laravel the request is secure
        fastcgi_param HTTPS on;
    }
}

# Redirect HTTP to HTTPS
server {
    listen 80;
    server_name yourdomain.com;
    return 301 https://$server_name$request_uri;
}
```

#### For Apache:

Add this to your `.htaccess` or virtual host configuration:

```apache
<IfModule mod_rewrite.c>
    RewriteEngine On

    # Force HTTPS
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>

# Security Headers
Header always set X-Frame-Options "SAMEORIGIN"
Header always set X-Content-Type-Options "nosniff"
Header always set X-XSS-Protection "1; mode=block"
```

### 4. If using a reverse proxy (like Cloudflare, Load Balancer)

Add these to your `.env`:

```env
# Trust proxies (use * to trust all proxies, or specify IPs)
TRUSTED_PROXIES=*

# Or specify specific proxy IPs
# TRUSTED_PROXIES=192.168.1.1,10.0.0.1
```

### 5. Restart services

```bash
# For Nginx
sudo systemctl restart nginx
sudo systemctl restart php8.2-fpm

# For Apache
sudo systemctl restart apache2
```

## Verification

After deployment, check:

1. Visit your site at `https://yourdomain.com`
2. Open browser console (F12) and check for mixed content warnings
3. Test the calendar, charts, and notifications features
4. Verify all external resources load correctly

## Troubleshooting

If you still see HTTPS errors:

1. **Clear browser cache** - Hard refresh (Ctrl+Shift+R or Cmd+Shift+R)

2. **Check Laravel logs** - `storage/logs/laravel.log`

3. **Verify SSL certificate** - Make sure your SSL certificate is valid and properly installed

4. **Check proxy headers** - If using a reverse proxy, ensure it's forwarding the correct headers:
   - `X-Forwarded-Proto: https`
   - `X-Forwarded-For: client-ip`

5. **Force HTTPS in routes** - All routes should automatically use HTTPS in production due to the `AppServiceProvider` update

## What Was Changed

The following file was updated to force HTTPS:

- **app/Providers/AppServiceProvider.php** - Added automatic HTTPS enforcement for production and secure requests

This ensures all URLs generated by Laravel (asset URLs, route URLs, etc.) use HTTPS when the application is accessed via HTTPS.
